import requests
import re
from openpyxl import Workbook
from bs4 import BeautifulSoup

base_url = 'https://cve.mitre.org'

cve_list_url = base_url + '/cgi-bin/cvekey.cgi?keyword=chromium'
proxies = { 'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
resp = requests.get(cve_list_url, proxies=proxies, verify='./cert.crt')

soup = BeautifulSoup(resp.text, 'html.parser')
l = soup.find_all(href=re.compile("/cgi-bin/cvename\.cgi"))

d = dict()
wb = Workbook()
file_name = 'cve-crbugId.xlsx'
ws = wb.active
row_num = 1
ws.append(["cve_number","crbug_id"])
row_num = row_num + 1

for e in l:
    if ('2023-43' in e['href']):
        cve_url = base_url + e['href']
        p_resp = requests.get(cve_url, proxies=proxies, verify='./cert.crt')
        p_soup = BeautifulSoup(p_resp.text, 'html.parser')
        crbug_url_tag = p_soup.find(href=re.compile("/crbug.com/"))
        
        cve_num = e.string
        if (crbug_url_tag.string != None):
            crbug_id = crbug_url_tag.string.split(':', 1)[1]
            d[cve_num] = crbug_id
        # print(cve_num)
        # print(crbug_id)
print(d)
for k in d:
    ws.append([k, d.get(k)])
wb.save(filename=file_name)
